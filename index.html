<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Line 打卡系統</title>
  <script src="https://static.line-scdn.net/liff/2.22/sdk.js"></script>
</head>

<body>
<h2>打卡系統</h2>
<button id="checkinBtn">立即打卡</button>

<script>
// ====== 取得用戶 IP ======
async function getIP() {
  const res = await fetch("https://api64.ipify.org?format=json");
  const data = await res.json();
  return data.ip;
}

// ====== LIFF 初始化 ======
async function main() {
  await liff.init({ liffId: "2008499706-eBayB9Yd" });

  if (!liff.isLoggedIn()) liff.login();

  document.getElementById("checkinBtn").onclick = checkin;
}

// ====== 進行打卡 ======
async function checkin() {
  const profile = await liff.getProfile();
  const ip = await getIP();
  
  const now = new Date();
  const loginDate = now.toLocaleDateString("zh-TW");
  const loginTime = now.toLocaleTimeString("zh-TW");

  // 組成傳送資料
  const payload = {
    userId: profile.userId,
    displayName: profile.displayName,
    loginDate: loginDate,
    loginTime: loginTime,
    ip: ip
  };

  // ====== 傳到 Google Apps Script ======
  fetch("https://script.google.com/macros/s/AKfycbyLQOC6SC-pveFLB3PTMb3l5dEm3aD-nC-v2TvPrqZAotBPFONfqrWFqt1yopcevyJ3/exec", {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  alert("打卡成功！");
}

main();
</script>
</body>
</html>









