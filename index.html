<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>LIFF 打卡</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
<h1>打卡系統</h1>
<button id="clock-in">上班打卡</button>
<button id="clock-out">下班打卡</button>

<script>
let userProfile = null;
const SHEET_API_URL = "https://script.google.com/macros/s/AKfycbzVC7we_LY0_LTO2Eho-AyF5pp9k4rB2eU4vJz1-PBC5QpGaPEeK_0Tf69O2uD68yMQ/exec";

async function initLiff() {
    await liff.init({ liffId: "2008504718-nmXP0WRV" });
    if (!liff.isLoggedIn()) liff.login();
    else userProfile = await liff.getProfile();
}

async function clock(type) {
    if (!userProfile) return alert("尚未取得用戶資訊");
    const record = {
        userId: userProfile.userId,
        name: userProfile.displayName,
        date: new Date().toLocaleDateString(),
        time: new Date().toLocaleTimeString(),
        type: type
    };
    try {
        const res = await fetch(SHEET_API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(record)
        });
        const result = await res.json();
        if (result.status === "success") alert(type + "打卡成功！");
        else alert("打卡失敗: " + result.message);
    } catch(err) {
        alert("打卡失敗: " + err.message);
    }
}

document.getElementById("clock-in").addEventListener("click", ()=>clock("上班"));
document.getElementById("clock-out").addEventListener("click", ()=>clock("下班"));

initLiff();
</script>
</body>
</html>













